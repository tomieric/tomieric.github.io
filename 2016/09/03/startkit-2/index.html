
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="前端 - 分享园">
    <title>配置5小时开发2分钟系列（2）—— gulp搭配browser-sync - 前端 - 分享园</title>
    <meta name="author" content="TommyShao">
    
    
        <link rel="alternative" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta name="description" content="最近火遍朋友圈的 在 2016 年学 JavaScript 是一种什么样的体验？，如果有一天选择做了前端，请把我埋在，深深的配置里…

在前两年觉得前端是最容易入门上手的，而近两年感觉门槛高了，各种眼花缭乱的构建工具，各种配置。 
本篇带来的是 gulp搭配browser-sync">
<meta property="og:type" content="blog">
<meta property="og:title" content="配置5小时开发2分钟系列（2）—— gulp搭配browser-sync">
<meta property="og:url" content="http://tomieric.github.io/2016/09/03/startkit-2/index.html">
<meta property="og:site_name" content="前端 - 分享园">
<meta property="og:description" content="最近火遍朋友圈的 在 2016 年学 JavaScript 是一种什么样的体验？，如果有一天选择做了前端，请把我埋在，深深的配置里…

在前两年觉得前端是最容易入门上手的，而近两年感觉门槛高了，各种眼花缭乱的构建工具，各种配置。 
本篇带来的是 gulp搭配browser-sync">
<meta property="og:updated_time" content="2016-10-09T05:20:58.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="配置5小时开发2分钟系列（2）—— gulp搭配browser-sync">
<meta name="twitter:description" content="最近火遍朋友圈的 在 2016 年学 JavaScript 是一种什么样的体验？，如果有一天选择做了前端，请把我埋在，深深的配置里…

在前两年觉得前端是最容易入门上手的，而近两年感觉门槛高了，各种眼花缭乱的构建工具，各种配置。 
本篇带来的是 gulp搭配browser-sync">
<meta name="twitter:creator" content="@tomieric">
    
        <meta rel="publisher" content="https://plus.google.com/+tomieric"/>
    
    
    
        <meta property="og:image" content="/assets/images/avatar.jpg"/>
    
    
        <meta property="og:image" content="/2016/09/03/startkit-2/http:/oenwuky9h.bkt.clouddn.com/WechatIMG9.jpeg?imageView2/1/w/280/h/280/interlace/1/q/60"/>
        <meta class="swiftype" name="image" data-type="enum" content="http://tomieric.github.io/2016/09/03/startkit-2/http://oenwuky9h.bkt.clouddn.com/WechatIMG9.jpeg?imageView2/1/w/280/h/280/interlace/1/q/60" />
    
    
        <meta property="og:image" content="/2016/09/03/startkit-2/http:/oenwuky9h.bkt.clouddn.com/WechatIMG9.jpeg?imageView2/0/interlace/1/q/60"/>
        <meta class="swiftype" name="image" data-type="enum" content="http://tomieric.github.io/2016/09/03/startkit-2/http://oenwuky9h.bkt.clouddn.com/WechatIMG9.jpeg?imageView2/0/interlace/1/q/60" />
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style.min.css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-71323455-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="3">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">前端 - 分享园</a>
    </h1>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/avatar.jpg"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="3">
    
        <div class="sidebar-profile">
            <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/avatar.jpg"/>
            </a>
            <span class="sidebar-profile-name">TommyShao</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">首页</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">分类</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">标签</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">归档</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">搜索</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://github.com/tomieric" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="http://weibo.com/tomieric" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-weibo"></i>
                    <span class="sidebar-button-desc">微博</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/atom.xml"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
        <div class="post-header-cover
                    text-left
                    "
             style="background-image:url('http://oenwuky9h.bkt.clouddn.com/WechatIMG9.jpeg?imageView2/0/interlace/1/q/60');"
             data-behavior="3">
            
                <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            配置5小时开发2分钟系列（2）—— gulp搭配browser-sync
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" content="Sat Sep 03 2016 00:00:00 GMT+0800">
	
		    9月 03, 2016
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/前端构建/">前端构建</a>


    
</div>
</div>
            
        </div>

            <div id="main" data-behavior="3"
                 class="hasCover
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <blockquote>
<p>最近火遍朋友圈的 <a href="https://www.v2ex.com/t/310767" target="_blank" rel="external">在 2016 年学 JavaScript 是一种什么样的体验？</a>，如果有一天选择做了前端，请把我埋在，深深的配置里…</p>
</blockquote>
<p>在前两年觉得前端是最容易入门上手的，而近两年感觉门槛高了，各种眼花缭乱的构建工具，各种配置。 </p>
<p>本篇带来的是 <code>gulp搭配browser-sync</code></p>
<a id="more"></a>
<h2 id="gulp搭配browser-sync"><a href="#gulp搭配browser-sync" class="headerlink" title="gulp搭配browser-sync"></a>gulp搭配browser-sync</h2><p>在<a href="/2016/09/01/startkit-1/">上一篇</a> 介绍了 <code>browser-sync</code>，本篇将介绍 <code>browser-sync</code> 搭载 <code>gulp</code> 实现构建环境。</p>
<p>grunt 在很久以前用过，配置方式不太喜欢，所以一直使用 gulp，gulp的入门介绍就不详细介绍，可以看两年前的介绍,<a href="http://tomieric.com/2014/08/20/gulp/" target="_blank" rel="external">Gulp.js构建工具入门</a></p>
<h3 id="gulp-配置开发"><a href="#gulp-配置开发" class="headerlink" title="gulp 配置开发"></a>gulp 配置开发</h3><p>在根目录下新建<code>gulpfile.js</code> 文件，此文件为 <code>gulp</code> 的入口文件，在终端直接输入 <code>gulp</code>命令即可以执行配置。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">touch</span> <span class="selector-tag">gulpfile</span><span class="selector-class">.js</span></div></pre></td></tr></table></figure>
<p>使用 gulp 为我们管理 <code>less编译</code>, <code>图片压缩</code>, <code>js压缩</code>, <code>模板编译</code>, <code>http 服务</code> 等，此时 gulpfile.js 文件将越来越臃肿。我们将 gulpfile.js 逐渐按业务逻辑拆分不同的文件。</p>
<p>模板项目整体结构如下</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── README.MD</div><div class="line">├── config.json      配置文件</div><div class="line">├── gulp             gulp 任务配置</div><div class="line">│   ├── <span class="class"><span class="keyword">lib</span>          工具函数</span></div><div class="line">│   └── task         gulp task 配置</div><div class="line">│        ├── defaultTask         默认任务，包括 ejs，less，编译及 server</div><div class="line">│        ├── spriteTask          sprite 合并任务，单独运行</div><div class="line">│        └── buildTask         构建</div><div class="line">├── gulpfile.js</div><div class="line">├── static</div><div class="line">│   ├── css</div><div class="line">│   ├── fonts</div><div class="line">│   ├── images</div><div class="line">│   ├── js</div><div class="line">│   └── less</div><div class="line">├── template           ejs模板</div><div class="line">│   ├── _common</div><div class="line">│   ├── upgrade.html</div><div class="line">│   └── 首页.html</div></pre></td></tr></table></figure>
<p>从结构中可以看到，将于 gulp相关的文件都放在 <code>gulp</code> 文件夹下，而且按业务逻辑分成 <code>defaultTask</code>默认的开发环境，<code>buildTask</code> 构建发布的生产环境。</p>
<p>此外static主要存放静态文件，template 存放 js 模板（使用 ejs 模板引擎管理静态页面，推荐更好的模板<a href="https://mozilla.github.io/nunjucks/cn/api.html" target="_blank" rel="external">Nunjucks</a>）</p>
<h3 id="1-入口文件"><a href="#1-入口文件" class="headerlink" title="1. 入口文件"></a>1. 入口文件</h3><p>入口文件为 gulp 构建工具默认的 <code>gulpfile.js</code>文件，只需将拆分的 task 任务导入</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*-------------</span></div><div class="line">*  默认任务</div><div class="line">-------------*/</div><div class="line"><span class="function"><span class="title">require</span><span class="params">(<span class="string">'./gulp/task/defaultTask'</span>)</span><span class="params">()</span></span></div><div class="line"></div><div class="line"><span class="comment">// code</span></div><div class="line">...</div></pre></td></tr></table></figure>
<p>因此我们需要在<code>./gulp/task/</code>目录下新建<code>defaultTask.js</code>文件，里面声明各自 task 执行的任务。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// defaultTask.js </span></div><div class="line"><span class="keyword">var</span> gulp   = <span class="built_in">require</span>(<span class="string">'gulp'</span>)</div><div class="line"><span class="comment">// 配置文件</span></div><div class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">'../../config.json'</span>)</div><div class="line"><span class="comment">// 项目信息</span></div><div class="line"><span class="keyword">var</span> pkg    = <span class="built_in">require</span>(<span class="string">'../../package.json'</span>)</div><div class="line"><span class="comment">// node 内置模块</span></div><div class="line"><span class="keyword">var</span> path   = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line"><span class="keyword">var</span> fs     = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"><span class="comment">// gulp 加载插件</span></div><div class="line"><span class="keyword">var</span> $      = <span class="built_in">require</span>(<span class="string">'gulp-load-plugins'</span>)()</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">defaultTask</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">//...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里使用的是<code>gulp-load-plugins</code>, 减少声明太多变量</p>
<p>插件：</p>
<ul>
<li><a href="https://github.com/jackfranklin/gulp-load-plugins" target="_blank" rel="external">https://github.com/jackfranklin/gulp-load-plugins</a></li>
</ul>
<h3 id="2-模板编译"><a href="#2-模板编译" class="headerlink" title="2. 模板编译"></a>2. 模板编译</h3><p>模板使用的是 <code>ejs</code>(<a href="http://ejs.co/" target="_blank" rel="external">http://ejs.co/</a>)，比较简单上手（前公司用的是nujucks,感觉更好用), <code>ejs</code> 支持变量的定义，js 语法，及<code>include</code>标签，方便我们对静态页面进行公共部分拆分,仿佛回到3，4年前写smarty，tp 模板的赶脚~</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">%-</span></span></span><span class="ruby"> <span class="keyword">include</span>(<span class="string">'_common/header.html'</span>, config) </span><span class="xml"><span class="tag">%&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">%</span></span><span class="ruby"> users.forEach(function(user)&#123; </span><span class="xml"><span class="tag">%&gt;</span></span></div><div class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span></span><span class="ruby"> user.name </span><span class="xml"><span class="tag">%&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></div><div class="line">            <span class="tag">&lt;<span class="name">%</span></span><span class="ruby"> &#125; </span><span class="xml"><span class="tag">%&gt;</span></span></div><div class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">%-</span></span><span class="ruby"> <span class="keyword">include</span>(<span class="string">'_common/list.html'</span>, [&#123;<span class="symbol">name:</span> <span class="string">'tommyshao'</span>&#125;, &#123;<span class="symbol">name:</span> <span class="string">'ray'</span>&#125;]) </span><span class="xml"><span class="tag">%&gt;</span></span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">%-</span></span><span class="ruby"> <span class="keyword">include</span>(<span class="string">'_common/footer.html'</span>) </span><span class="xml"><span class="tag">%&gt;</span></span></div></pre></td></tr></table></figure>
<p>在 gulp 使用只需要 <code>$.ejs({ config: config})</code>,其中 config 传入的是配置文件中的变量。模板中的公共模板(定义<code>_</code>开头的文件或者文件夹)不需要编译因此需要过滤。完整的代码：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 模板编译</span></div><div class="line">gulp.task(<span class="string">'template'</span>, function() &#123;</div><div class="line">    <span class="keyword">return</span> gulp.src([config.template+<span class="string">'/**/**.html'</span>, <span class="string">'!'</span>+config.template+<span class="string">'/**/_**.html'</span>, <span class="string">'!'</span>+config.template+<span class="string">'/_**/**.html'</span>])</div><div class="line">                .pipe($.ejs(&#123; config: config&#125;))</div><div class="line">                .pipe($.prettify(&#123; indent_size: 2&#125;))</div><div class="line">                .pipe($.plumber(&#123; errorHandler: $.notify.onError('错误: &lt;%= <span class="keyword">error</span>.message%&gt;')&#125;))</div><div class="line">                .pipe(gulp.dest(config.destPath))</div><div class="line">                .pipe(reload(&#123; stream: <span class="keyword">true</span> &#125;))</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<ul>
<li><code>config.template</code> 配置文件中模板的目录</li>
<li><code>config.destPath</code> 配置文件中模板编译后的目录，也是 http server 的根目录</li>
<li><code>$.prettify({ indent_size: 2})</code> 输出 html 以2个空格格式化</li>
</ul>
<p>插件：</p>
<ul>
<li><a href="https://github.com/rogeriopvl/gulp-ejs" target="_blank" rel="external">https://github.com/rogeriopvl/gulp-ejs</a></li>
<li><a href="https://github.com/jonschlinkert/gulp-prettify" target="_blank" rel="external">https://github.com/jonschlinkert/gulp-prettify</a></li>
<li><a href="https://github.com/floatdrop/gulp-plumber" target="_blank" rel="external">https://github.com/floatdrop/gulp-plumber</a></li>
</ul>
<h3 id="3-less-样式编译"><a href="#3-less-样式编译" class="headerlink" title="3. less 样式编译"></a>3. less 样式编译</h3><p>less(<a href="http://lesscss.org/" target="_blank" rel="external">http://lesscss.org/</a>)是 css 的预编译器，可以定义变量，mixin，函数等，功能比较齐全和轻便。</p>
<p>为了减少写更多的 mixin，这里推荐一个比较好用的插件<code>autoprefixer</code>,它是属于现在比较火的预编译器<code>postcss</code>内置组件。</p>
<p>less 最终编译成 css，在调试的时候如何快速定位到 less 源文件的语句呢，需要使用到 <code>sourcemaps</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// less 编译</span></div><div class="line">gulp.task(<span class="string">'less'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> gulp.src([config.staticPath+<span class="string">'/less/**/**.less'</span>, <span class="string">'!'</span>+ config.staticPath+<span class="string">'/less/**/_**.less'</span>, <span class="string">'!'</span>+ config.staticPath+<span class="string">'/less/_**/**.less'</span>])</div><div class="line">            .pipe($.sourcemaps.init())</div><div class="line">            .pipe($.plumber(&#123; errorHandler: $.notify.onError(<span class="string">'错误: &lt;%= error.message %&gt;'</span>)&#125;))</div><div class="line">            .pipe($.less())</div><div class="line">            .pipe($.autoprefixer(<span class="string">'last 2 version'</span>, <span class="string">'not ie &lt;= 8'</span>))</div><div class="line">            .pipe($.sourcemaps.write(<span class="string">'./maps'</span>))</div><div class="line">            .pipe(gulp.dest(config.staticPath+<span class="string">'/css'</span>))</div><div class="line">            .pipe(reload(&#123; stream: <span class="literal">true</span> &#125;))</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<ul>
<li><code>$.sourcemaps.init()</code>, <code>$.sourcemaps.write(&#39;./maps&#39;)</code> sourcemaps声明</li>
<li><code>$.less()</code> less 文件编译</li>
<li><code>$.autoprefixer(&#39;last 2 version&#39;, &#39;not ie &lt;= 8&#39;)</code> 浏览器css 语法自动增加前缀（-webkit，-moz），最新两款浏览器，IE8以上</li>
</ul>
<p>插件：</p>
<ul>
<li><a href="https://github.com/floridoo/gulp-sourcemaps" target="_blank" rel="external">https://github.com/floridoo/gulp-sourcemaps</a></li>
<li><a href="https://github.com/plus3network/gulp-less" target="_blank" rel="external">https://github.com/plus3network/gulp-less</a></li>
<li><a href="https://github.com/sindresorhus/gulp-autoprefixer" target="_blank" rel="external">https://github.com/sindresorhus/gulp-autoprefixer</a></li>
</ul>
<h3 id="4-即时刷新-watch"><a href="#4-即时刷新-watch" class="headerlink" title="4. 即时刷新 watch"></a>4. 即时刷新 watch</h3><p>即时刷新主要是监听静态资源和 html 页面文件的内容变更，浏览器第一时间刷新页面。 使用 <code>gulp.watch</code>搭配<code>browser-sync</code> 的 <code>reload</code> 函数</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 监听及时刷新</span></div><div class="line"><span class="selector-tag">gulp</span><span class="selector-class">.task</span>(<span class="string">'watch'</span>, function() &#123;</div><div class="line">    gulp<span class="selector-class">.watch</span>(config.template + <span class="string">'/**/**.html'</span>, [<span class="string">'template'</span>])</div><div class="line">    <span class="selector-tag">gulp</span><span class="selector-class">.watch</span>(config.staticPath + <span class="string">'/less/**/**'</span>, [<span class="string">'less'</span>])</div><div class="line">    <span class="selector-tag">gulp</span><span class="selector-class">.watch</span>(config.staticPath + <span class="string">'/js/**/**'</span>)<span class="selector-class">.on</span>(<span class="string">'change'</span>, reload)</div><div class="line">    <span class="selector-tag">gulp</span><span class="selector-class">.watch</span>(config.staticPath + <span class="string">'/images/**/**'</span>)<span class="selector-class">.on</span>(<span class="string">'change'</span>, reload)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><code>reload</code>在文件头部的声明使用</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// http server</span></div><div class="line"><span class="selector-tag">var</span> browserSync = require(<span class="string">'browser-sync'</span>).create()</div><div class="line"><span class="selector-tag">var</span> reload      = browserSync<span class="selector-class">.reload</span></div><div class="line"></div><div class="line"></div><div class="line">...</div><div class="line">    .pipe(reload(&#123; stream: true &#125;))</div></pre></td></tr></table></figure>
<p>插件：</p>
<ul>
<li><a href="https://browsersync.io/" target="_blank" rel="external">https://browsersync.io/</a></li>
</ul>
<h3 id="5-sprite-雪碧图合并"><a href="#5-sprite-雪碧图合并" class="headerlink" title="5. sprite 雪碧图合并"></a>5. sprite 雪碧图合并</h3><p>sprite雪碧图合并可以将多张图片生成一张图片并生成 css 样式文件</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var spritesmith = require(<span class="string">'gulp.spritesmith'</span>)</div><div class="line"></div><div class="line">spritesmith(&#123;</div><div class="line">    imgPath: <span class="string">'../images/sprite/icon-home.png?v='</span>+ <span class="built_in">config</span>.version,</div><div class="line">    imgName: folder+<span class="string">'.png'</span>,</div><div class="line">    cssName: <span class="string">'_'</span>+ folder+<span class="string">'.css'</span>,</div><div class="line">    padding: <span class="built_in">config</span>.sprite_padding</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>因此可以设计出多张 sprite 并发处理。详看：<a href="https://github.com/tomieric/gulp-browsersync-boilerplate/blob/master/gulp/task/spriteTask.js" target="_blank" rel="external">https://github.com/tomieric/gulp-browsersync-boilerplate/blob/master/gulp/task/spriteTask.js</a> </p>
<h3 id="6-browser-sync-配置"><a href="#6-browser-sync-配置" class="headerlink" title="6. browser-sync 配置"></a>6. browser-sync 配置</h3><p>在上一篇就介绍了<code>browser-sync</code> 作为 http server 服务的优点。这里我们就使用 <code>browser-sync</code>的 api 搭载 gulp 来使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// http server</span></div><div class="line"><span class="keyword">var</span> browserSync = <span class="built_in">require</span>(<span class="string">'browser-sync'</span>).create()</div><div class="line"></div><div class="line"><span class="comment">// 启动服务</span></div><div class="line">gulp.task(<span class="string">'server'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">    browserSync.init(&#123;</div><div class="line">        <span class="comment">// 界面管理工具</span></div><div class="line">        ui: &#123;</div><div class="line">            port: <span class="number">8080</span>,</div><div class="line">            weinre: &#123; <span class="comment">// weinre工具移动设备代理端口</span></div><div class="line">                port: <span class="number">9090</span></div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        server: &#123;</div><div class="line">            <span class="comment">// 目录都作为根目录访问</span></div><div class="line">            baseDir: [<span class="string">'./'</span>+ config.destPath, <span class="string">'./static'</span>],</div><div class="line">            directory: <span class="literal">true</span>,</div><div class="line">            routes: &#123;</div><div class="line">                <span class="string">'/bower_components'</span>: <span class="string">'./bower_components'</span></div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        host: Lib.getIPAddress(),</div><div class="line">        port: config.port,</div><div class="line">        <span class="comment">// 使用浏览器打开</span></div><div class="line">        <span class="comment">// 可以自定义配置</span></div><div class="line">        <span class="comment">//   browser: ['chrome', 'firefox', 'Internet Explore']</span></div><div class="line">        <span class="comment">// 只启动 chrome 开发</span></div><div class="line">        browser: [<span class="string">'google chrome'</span>,<span class="string">'chrome'</span>],</div><div class="line">        <span class="comment">// 管理代理</span></div><div class="line">        <span class="comment">// middleware: [jsonProxy]</span></div><div class="line">    &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>具体的<code>browser-sync</code> 配置和介绍请看系列一的介绍。传送门： <a href="/2016/09/01/startkit-1/">即时刷新的browser-sync</a></p>
<h3 id="7-接口代理"><a href="#7-接口代理" class="headerlink" title="7. 接口代理"></a>7. 接口代理</h3><p>在前端开发中比如需要ajax请求数据，做 js 模板的渲染等，我们如何请求另一台服务器的数据呢？很明显存在着跨域问题，很多同学说还不简单使用 jsonp 啊。</p>
<p>但是不是还有比 jsonp 更简单的呢，就是将另一台服务器的接口代理到本地服务器，这样就作为同域处理了，比如我们代理了测试服务器上的数据，前后端的开发彼此不受影响，前端发布到测试服务器后可以上线对接。</p>
<p>这里使用http 代理中间件<code>http-proxy-middleware</code>, 支持 <code>connect</code>,<code>express</code>,<code>browser-sync</code></p>
<p>导入<code>http-proxy-middleware</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// http proxy</span></div><div class="line"><span class="keyword">var</span> httpProxy = <span class="built_in">require</span>(<span class="string">'http-proxy-middleware'</span>)</div><div class="line"></div><div class="line"><span class="comment">// 代理本地 http 请求以`/api/`开头的</span></div><div class="line"><span class="comment">// 统一返回 代理到测试服务器上接口数据</span></div><div class="line"><span class="comment">// 比如本地请求 /api/getUserInfo 返回的是测试服务器上的/getUserInfo接口数据</span></div><div class="line"><span class="keyword">var</span> jsonProxy = httpProxy(<span class="string">'/api/'</span>, &#123;</div><div class="line">    target: <span class="string">'http://xxx.xxx.xxx.xxx:2016'</span>,</div><div class="line">    changeOrigin: <span class="literal">true</span>,</div><div class="line">    pathRewrite: &#123;</div><div class="line">        <span class="string">'/api'</span>: <span class="string">''</span></div><div class="line">    &#125;,</div><div class="line">    logLevel: <span class="string">'debug'</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>在<code>browser-sync</code>中启用代理</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">browserSync</span><span class="selector-class">.init</span>(&#123;</div><div class="line">    ...</div><div class="line">    <span class="comment">// http proxy </span></div><div class="line">    <span class="selector-tag">middleware</span>: <span class="selector-attr">[jsonProxy]</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>插件：</p>
<ul>
<li><a href="https://github.com/chimurai/http-proxy-middleware" target="_blank" rel="external">https://github.com/chimurai/http-proxy-middleware</a></li>
</ul>
<h3 id="8-默认任务"><a href="#8-默认任务" class="headerlink" title="8. 默认任务"></a>8. 默认任务</h3><p><code>gulp</code> 命令默认执行 <code>gulp.task(&#39;default&#39;, fn)</code> 定义的任务。 如何将我们以上的任务组合在一起，使用<code>gulp.start([task1, task2])</code>, 由于<code>gulp.start</code>是并发式执行任务，这里推荐更好的队列方式插件来组合执行任务，按照声明的先后执行 task。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">gulp</span><span class="selector-class">.task</span>(<span class="string">'default'</span>, function(cb)&#123;</div><div class="line">    $<span class="selector-class">.sequence</span>(<span class="string">'template:clean'</span>, [<span class="string">'template'</span>, <span class="string">'less'</span>], <span class="string">'server'</span>, <span class="string">'watch'</span>)(cb)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>插件：</p>
<ul>
<li><a href="https://github.com/teambition/gulp-sequence" target="_blank" rel="external">https://github.com/teambition/gulp-sequence</a></li>
</ul>
<h2 id="构建发布生产及配置文件"><a href="#构建发布生产及配置文件" class="headerlink" title="构建发布生产及配置文件"></a>构建发布生产及配置文件</h2><p>构建发布生产环境主要做静态文件压缩，增加版权信息，拷贝。这里不详细阐述，具体查看 github。</p>
<p>配置文件 <code>config.json</code>，自定义分离出弹性可配置项，只有开发者自行修改 json 的字段，比如开发环境端口，生产环境预览端口等。生成发布的目录，在前公司直接生成到 svn 的目录上，再同步到公司项目。</p>
<p>Git项目地址：<br><a href="https://github.com/tomieric/gulp-browsersync-boilerplate" target="_blank" rel="external">https://github.com/tomieric/gulp-browsersync-boilerplate</a>， 欢迎 star！</p>
<ul>
<li><a href="/2016/09/01/startkit-1/">配置5小时开发2分钟系列（1）</a></li>
<li><a href="/2016/09/03/startkit-2/">配置5小时开发2分钟系列（2）</a></li>
<li><a href="/2016/09/05/startkit-3/">配置5小时开发2分钟系列（3）</a></li>
<li><a href="/2016/09/08/startkit-4/">配置5小时开发2分钟系列（4）</a>·</li>
</ul>

            
                

            
        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">标签</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/browser-sync/">browser-sync</a> <a class="tag tag--primary tag--small t-link" href="/tags/gulp/">gulp</a> <a class="tag tag--primary tag--small t-link" href="/tags/webpack/">webpack</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/09/05/startkit-3/"  data-tooltip="配置5小时开发2分钟系列（3）—— webpack 搭配 react">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/09/01/startkit-1/" data-tooltip="配置5小时开发2分钟系列（1）—— 即时刷新的browser-sync">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>


    <div class="post-actions post-action-share" style="float: left;padding-top:15px">
    <div class="ds-share" data-thread-key="2016/09/03/startkit-2/" data-title="配置5小时开发2分钟系列（2）—— gulp搭配browser-sync" data-images="" data-content="&lt;blockquote&gt;
&lt;p&gt;最近火遍朋友圈的 &lt;a href=&quot;https://www.v2ex.com/t/310767&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;在 2016 年学 JavaScript 是一种什么样的体验？&lt;/a&gt;，如果有一天选择做了前端，请把我埋在，深深的配置里…&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在前两年觉得前端是最容易入门上手的，而近两年感觉门槛高了，各种眼花缭乱的构建工具，各种配置。 &lt;/p&gt;
&lt;p&gt;本篇带来的是 &lt;code&gt;gulp搭配browser-sync&lt;/code&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;gulp搭配browser-sync&quot;&gt;&lt;a href=&quot;#gulp搭配browser-sync&quot; class=&quot;headerlink&quot; title=&quot;gulp搭配browser-sync&quot;&gt;&lt;/a&gt;gulp搭配browser-sync&lt;/h2&gt;&lt;p&gt;在&lt;a href=&quot;/2016/09/01/startkit-1/&quot;&gt;上一篇&lt;/a&gt; 介绍了 &lt;code&gt;browser-sync&lt;/code&gt;，本篇将介绍 &lt;code&gt;browser-sync&lt;/code&gt; 搭载 &lt;code&gt;gulp&lt;/code&gt; 实现构建环境。&lt;/p&gt;
&lt;p&gt;grunt 在很久以前用过，配置方式不太喜欢，所以一直使用 gulp，gulp的入门介绍就不详细介绍，可以看两年前的介绍,&lt;a href=&quot;http://tomieric.com/2014/08/20/gulp/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Gulp.js构建工具入门&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;gulp-配置开发&quot;&gt;&lt;a href=&quot;#gulp-配置开发&quot; class=&quot;headerlink&quot; title=&quot;gulp 配置开发&quot;&gt;&lt;/a&gt;gulp 配置开发&lt;/h3&gt;&lt;p&gt;在根目录下新建&lt;code&gt;gulpfile.js&lt;/code&gt; 文件，此文件为 &lt;code&gt;gulp&lt;/code&gt; 的入口文件，在终端直接输入 &lt;code&gt;gulp&lt;/code&gt;命令即可以执行配置。&lt;/p&gt;
&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;touch&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;gulpfile&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.js&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;使用 gulp 为我们管理 &lt;code&gt;less编译&lt;/code&gt;, &lt;code&gt;图片压缩&lt;/code&gt;, &lt;code&gt;js压缩&lt;/code&gt;, &lt;code&gt;模板编译&lt;/code&gt;, &lt;code&gt;http 服务&lt;/code&gt; 等，此时 gulpfile.js 文件将越来越臃肿。我们将 gulpfile.js 逐渐按业务逻辑拆分不同的文件。&lt;/p&gt;
&lt;p&gt;模板项目整体结构如下&lt;/p&gt;
&lt;figure class=&quot;highlight crystal&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;├── README.MD&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;├── config.json      配置文件&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;├── gulp             gulp 任务配置&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   ├── &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;lib&lt;/span&gt;          工具函数&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   └── task         gulp task 配置&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│        ├── defaultTask         默认任务，包括 ejs，less，编译及 server&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│        ├── spriteTask          sprite 合并任务，单独运行&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│        └── buildTask         构建&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;├── gulpfile.js&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;├── static&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   ├── css&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   ├── fonts&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   ├── images&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   ├── js&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   └── less&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;├── template           ejs模板&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   ├── _common&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   ├── upgrade.html&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   └── 首页.html&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;从结构中可以看到，将于 gulp相关的文件都放在 &lt;code&gt;gulp&lt;/code&gt; 文件夹下，而且按业务逻辑分成 &lt;code&gt;defaultTask&lt;/code&gt;默认的开发环境，&lt;code&gt;buildTask&lt;/code&gt; 构建发布的生产环境。&lt;/p&gt;
&lt;p&gt;此外static主要存放静态文件，template 存放 js 模板（使用 ejs 模板引擎管理静态页面，推荐更好的模板&lt;a href=&quot;https://mozilla.github.io/nunjucks/cn/api.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Nunjucks&lt;/a&gt;）&lt;/p&gt;
&lt;h3 id=&quot;1-入口文件&quot;&gt;&lt;a href=&quot;#1-入口文件&quot; class=&quot;headerlink&quot; title=&quot;1. 入口文件&quot;&gt;&lt;/a&gt;1. 入口文件&lt;/h3&gt;&lt;p&gt;入口文件为 gulp 构建工具默认的 &lt;code&gt;gulpfile.js&lt;/code&gt;文件，只需将拆分的 task 任务导入&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*-------------&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;*  默认任务&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-------------*/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;string&quot;&gt;&#39;./gulp/task/defaultTask&#39;&lt;/span&gt;)&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// code&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;...&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;因此我们需要在&lt;code&gt;./gulp/task/&lt;/code&gt;目录下新建&lt;code&gt;defaultTask.js&lt;/code&gt;文件，里面声明各自 task 执行的任务。&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// defaultTask.js &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; gulp   = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;gulp&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 配置文件&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; config = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;../../config.json&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 项目信息&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; pkg    = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;../../package.json&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// node 内置模块&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; path   = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;path&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; fs     = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;fs&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// gulp 加载插件&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; $      = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;gulp-load-plugins&#39;&lt;/span&gt;)()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.exports = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;defaultTask&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//...&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里使用的是&lt;code&gt;gulp-load-plugins&lt;/code&gt;, 减少声明太多变量&lt;/p&gt;
&lt;p&gt;插件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/jackfranklin/gulp-load-plugins&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/jackfranklin/gulp-load-plugins&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2-模板编译&quot;&gt;&lt;a href=&quot;#2-模板编译&quot; class=&quot;headerlink&quot; title=&quot;2. 模板编译&quot;&gt;&lt;/a&gt;2. 模板编译&lt;/h3&gt;&lt;p&gt;模板使用的是 &lt;code&gt;ejs&lt;/code&gt;(&lt;a href=&quot;http://ejs.co/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://ejs.co/&lt;/a&gt;)，比较简单上手（前公司用的是nujucks,感觉更好用), &lt;code&gt;ejs&lt;/code&gt; 支持变量的定义，js 语法，及&lt;code&gt;include&lt;/code&gt;标签，方便我们对静态页面进行公共部分拆分,仿佛回到3，4年前写smarty，tp 模板的赶脚~&lt;/p&gt;
&lt;figure class=&quot;highlight erb&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;%-&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;_common/header.html&#39;&lt;/span&gt;, config) &lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;container&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;ul&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;%&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; users.forEach(function(user)&amp;#123; &lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;%=&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; user.name &lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;%&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; &amp;#125; &lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;ul&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;%-&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;_common/list.html&#39;&lt;/span&gt;, [&amp;#123;&lt;span class=&quot;symbol&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;tommyshao&#39;&lt;/span&gt;&amp;#125;, &amp;#123;&lt;span class=&quot;symbol&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;ray&#39;&lt;/span&gt;&amp;#125;]) &lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;%-&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;_common/footer.html&#39;&lt;/span&gt;) &lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在 gulp 使用只需要 &lt;code&gt;$.ejs({ config: config})&lt;/code&gt;,其中 config 传入的是配置文件中的变量。模板中的公共模板(定义&lt;code&gt;_&lt;/code&gt;开头的文件或者文件夹)不需要编译因此需要过滤。完整的代码：&lt;/p&gt;
&lt;figure class=&quot;highlight aspectj&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 模板编译&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;gulp.task(&lt;span class=&quot;string&quot;&gt;&#39;template&#39;&lt;/span&gt;, function() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; gulp.src([config.template+&lt;span class=&quot;string&quot;&gt;&#39;/**/**.html&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;!&#39;&lt;/span&gt;+config.template+&lt;span class=&quot;string&quot;&gt;&#39;/**/_**.html&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;!&#39;&lt;/span&gt;+config.template+&lt;span class=&quot;string&quot;&gt;&#39;/_**/**.html&#39;&lt;/span&gt;])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                .pipe($.ejs(&amp;#123; config: config&amp;#125;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                .pipe($.prettify(&amp;#123; indent_size: 2&amp;#125;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                .pipe($.plumber(&amp;#123; errorHandler: $.notify.onError(&#39;错误: &amp;lt;%= &lt;span class=&quot;keyword&quot;&gt;error&lt;/span&gt;.message%&amp;gt;&#39;)&amp;#125;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                .pipe(gulp.dest(config.destPath))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                .pipe(reload(&amp;#123; stream: &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt; &amp;#125;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;config.template&lt;/code&gt; 配置文件中模板的目录&lt;/li&gt;
&lt;li&gt;&lt;code&gt;config.destPath&lt;/code&gt; 配置文件中模板编译后的目录，也是 http server 的根目录&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$.prettify({ indent_size: 2})&lt;/code&gt; 输出 html 以2个空格格式化&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;插件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/rogeriopvl/gulp-ejs&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/rogeriopvl/gulp-ejs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/jonschlinkert/gulp-prettify&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/jonschlinkert/gulp-prettify&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/floatdrop/gulp-plumber&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/floatdrop/gulp-plumber&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;3-less-样式编译&quot;&gt;&lt;a href=&quot;#3-less-样式编译&quot; class=&quot;headerlink&quot; title=&quot;3. less 样式编译&quot;&gt;&lt;/a&gt;3. less 样式编译&lt;/h3&gt;&lt;p&gt;less(&lt;a href=&quot;http://lesscss.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://lesscss.org/&lt;/a&gt;)是 css 的预编译器，可以定义变量，mixin，函数等，功能比较齐全和轻便。&lt;/p&gt;
&lt;p&gt;为了减少写更多的 mixin，这里推荐一个比较好用的插件&lt;code&gt;autoprefixer&lt;/code&gt;,它是属于现在比较火的预编译器&lt;code&gt;postcss&lt;/code&gt;内置组件。&lt;/p&gt;
&lt;p&gt;less 最终编译成 css，在调试的时候如何快速定位到 less 源文件的语句呢，需要使用到 &lt;code&gt;sourcemaps&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// less 编译&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;gulp.task(&lt;span class=&quot;string&quot;&gt;&#39;less&#39;&lt;/span&gt;, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; gulp.src([config.staticPath+&lt;span class=&quot;string&quot;&gt;&#39;/less/**/**.less&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;!&#39;&lt;/span&gt;+ config.staticPath+&lt;span class=&quot;string&quot;&gt;&#39;/less/**/_**.less&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;!&#39;&lt;/span&gt;+ config.staticPath+&lt;span class=&quot;string&quot;&gt;&#39;/less/_**/**.less&#39;&lt;/span&gt;])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .pipe($.sourcemaps.init())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .pipe($.plumber(&amp;#123; errorHandler: $.notify.onError(&lt;span class=&quot;string&quot;&gt;&#39;错误: &amp;lt;%= error.message %&amp;gt;&#39;&lt;/span&gt;)&amp;#125;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .pipe($.less())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .pipe($.autoprefixer(&lt;span class=&quot;string&quot;&gt;&#39;last 2 version&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;not ie &amp;lt;= 8&#39;&lt;/span&gt;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .pipe($.sourcemaps.write(&lt;span class=&quot;string&quot;&gt;&#39;./maps&#39;&lt;/span&gt;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .pipe(gulp.dest(config.staticPath+&lt;span class=&quot;string&quot;&gt;&#39;/css&#39;&lt;/span&gt;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .pipe(reload(&amp;#123; stream: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt; &amp;#125;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;$.sourcemaps.init()&lt;/code&gt;, &lt;code&gt;$.sourcemaps.write(&amp;#39;./maps&amp;#39;)&lt;/code&gt; sourcemaps声明&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$.less()&lt;/code&gt; less 文件编译&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$.autoprefixer(&amp;#39;last 2 version&amp;#39;, &amp;#39;not ie &amp;lt;= 8&amp;#39;)&lt;/code&gt; 浏览器css 语法自动增加前缀（-webkit，-moz），最新两款浏览器，IE8以上&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;插件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/floridoo/gulp-sourcemaps&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/floridoo/gulp-sourcemaps&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/plus3network/gulp-less&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/plus3network/gulp-less&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/sindresorhus/gulp-autoprefixer&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/sindresorhus/gulp-autoprefixer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;4-即时刷新-watch&quot;&gt;&lt;a href=&quot;#4-即时刷新-watch&quot; class=&quot;headerlink&quot; title=&quot;4. 即时刷新 watch&quot;&gt;&lt;/a&gt;4. 即时刷新 watch&lt;/h3&gt;&lt;p&gt;即时刷新主要是监听静态资源和 html 页面文件的内容变更，浏览器第一时间刷新页面。 使用 &lt;code&gt;gulp.watch&lt;/code&gt;搭配&lt;code&gt;browser-sync&lt;/code&gt; 的 &lt;code&gt;reload&lt;/code&gt; 函数&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 监听及时刷新&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;gulp&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.task&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;watch&#39;&lt;/span&gt;, function() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    gulp&lt;span class=&quot;selector-class&quot;&gt;.watch&lt;/span&gt;(config.template + &lt;span class=&quot;string&quot;&gt;&#39;/**/**.html&#39;&lt;/span&gt;, [&lt;span class=&quot;string&quot;&gt;&#39;template&#39;&lt;/span&gt;])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-tag&quot;&gt;gulp&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.watch&lt;/span&gt;(config.staticPath + &lt;span class=&quot;string&quot;&gt;&#39;/less/**/**&#39;&lt;/span&gt;, [&lt;span class=&quot;string&quot;&gt;&#39;less&#39;&lt;/span&gt;])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-tag&quot;&gt;gulp&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.watch&lt;/span&gt;(config.staticPath + &lt;span class=&quot;string&quot;&gt;&#39;/js/**/**&#39;&lt;/span&gt;)&lt;span class=&quot;selector-class&quot;&gt;.on&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;change&#39;&lt;/span&gt;, reload)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-tag&quot;&gt;gulp&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.watch&lt;/span&gt;(config.staticPath + &lt;span class=&quot;string&quot;&gt;&#39;/images/**/**&#39;&lt;/span&gt;)&lt;span class=&quot;selector-class&quot;&gt;.on&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;change&#39;&lt;/span&gt;, reload)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;reload&lt;/code&gt;在文件头部的声明使用&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// http server&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; browserSync = require(&lt;span class=&quot;string&quot;&gt;&#39;browser-sync&#39;&lt;/span&gt;).create()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; reload      = browserSync&lt;span class=&quot;selector-class&quot;&gt;.reload&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    .pipe(reload(&amp;#123; stream: true &amp;#125;))&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;插件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://browsersync.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://browsersync.io/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;5-sprite-雪碧图合并&quot;&gt;&lt;a href=&quot;#5-sprite-雪碧图合并&quot; class=&quot;headerlink&quot; title=&quot;5. sprite 雪碧图合并&quot;&gt;&lt;/a&gt;5. sprite 雪碧图合并&lt;/h3&gt;&lt;p&gt;sprite雪碧图合并可以将多张图片生成一张图片并生成 css 样式文件&lt;/p&gt;
&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;var spritesmith = require(&lt;span class=&quot;string&quot;&gt;&#39;gulp.spritesmith&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;spritesmith(&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    imgPath: &lt;span class=&quot;string&quot;&gt;&#39;../images/sprite/icon-home.png?v=&#39;&lt;/span&gt;+ &lt;span class=&quot;built_in&quot;&gt;config&lt;/span&gt;.version,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    imgName: folder+&lt;span class=&quot;string&quot;&gt;&#39;.png&#39;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    cssName: &lt;span class=&quot;string&quot;&gt;&#39;_&#39;&lt;/span&gt;+ folder+&lt;span class=&quot;string&quot;&gt;&#39;.css&#39;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    padding: &lt;span class=&quot;built_in&quot;&gt;config&lt;/span&gt;.sprite_padding&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;因此可以设计出多张 sprite 并发处理。详看：&lt;a href=&quot;https://github.com/tomieric/gulp-browsersync-boilerplate/blob/master/gulp/task/spriteTask.js&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/tomieric/gulp-browsersync-boilerplate/blob/master/gulp/task/spriteTask.js&lt;/a&gt; &lt;/p&gt;
&lt;h3 id=&quot;6-browser-sync-配置&quot;&gt;&lt;a href=&quot;#6-browser-sync-配置&quot; class=&quot;headerlink&quot; title=&quot;6. browser-sync 配置&quot;&gt;&lt;/a&gt;6. browser-sync 配置&lt;/h3&gt;&lt;p&gt;在上一篇就介绍了&lt;code&gt;browser-sync&lt;/code&gt; 作为 http server 服务的优点。这里我们就使用 &lt;code&gt;browser-sync&lt;/code&gt;的 api 搭载 gulp 来使用。&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// http server&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; browserSync = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;browser-sync&#39;&lt;/span&gt;).create()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 启动服务&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;gulp.task(&lt;span class=&quot;string&quot;&gt;&#39;server&#39;&lt;/span&gt;, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    browserSync.init(&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// 界面管理工具&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        ui: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            port: &lt;span class=&quot;number&quot;&gt;8080&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            weinre: &amp;#123; &lt;span class=&quot;comment&quot;&gt;// weinre工具移动设备代理端口&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                port: &lt;span class=&quot;number&quot;&gt;9090&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        server: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// 目录都作为根目录访问&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            baseDir: [&lt;span class=&quot;string&quot;&gt;&#39;./&#39;&lt;/span&gt;+ config.destPath, &lt;span class=&quot;string&quot;&gt;&#39;./static&#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            directory: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            routes: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&#39;/bower_components&#39;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&#39;./bower_components&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        host: Lib.getIPAddress(),&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        port: config.port,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// 使用浏览器打开&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// 可以自定义配置&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//   browser: [&#39;chrome&#39;, &#39;firefox&#39;, &#39;Internet Explore&#39;]&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// 只启动 chrome 开发&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        browser: [&lt;span class=&quot;string&quot;&gt;&#39;google chrome&#39;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;chrome&#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// 管理代理&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// middleware: [jsonProxy]&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;具体的&lt;code&gt;browser-sync&lt;/code&gt; 配置和介绍请看系列一的介绍。传送门： &lt;a href=&quot;/2016/09/01/startkit-1/&quot;&gt;即时刷新的browser-sync&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;7-接口代理&quot;&gt;&lt;a href=&quot;#7-接口代理&quot; class=&quot;headerlink&quot; title=&quot;7. 接口代理&quot;&gt;&lt;/a&gt;7. 接口代理&lt;/h3&gt;&lt;p&gt;在前端开发中比如需要ajax请求数据，做 js 模板的渲染等，我们如何请求另一台服务器的数据呢？很明显存在着跨域问题，很多同学说还不简单使用 jsonp 啊。&lt;/p&gt;
&lt;p&gt;但是不是还有比 jsonp 更简单的呢，就是将另一台服务器的接口代理到本地服务器，这样就作为同域处理了，比如我们代理了测试服务器上的数据，前后端的开发彼此不受影响，前端发布到测试服务器后可以上线对接。&lt;/p&gt;
&lt;p&gt;这里使用http 代理中间件&lt;code&gt;http-proxy-middleware&lt;/code&gt;, 支持 &lt;code&gt;connect&lt;/code&gt;,&lt;code&gt;express&lt;/code&gt;,&lt;code&gt;browser-sync&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;导入&lt;code&gt;http-proxy-middleware&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// http proxy&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; httpProxy = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;http-proxy-middleware&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 代理本地 http 请求以`/api/`开头的&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 统一返回 代理到测试服务器上接口数据&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 比如本地请求 /api/getUserInfo 返回的是测试服务器上的/getUserInfo接口数据&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; jsonProxy = httpProxy(&lt;span class=&quot;string&quot;&gt;&#39;/api/&#39;&lt;/span&gt;, &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    target: &lt;span class=&quot;string&quot;&gt;&#39;http://xxx.xxx.xxx.xxx:2016&#39;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    changeOrigin: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    pathRewrite: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&#39;/api&#39;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    logLevel: &lt;span class=&quot;string&quot;&gt;&#39;debug&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在&lt;code&gt;browser-sync&lt;/code&gt;中启用代理&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;browserSync&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.init&lt;/span&gt;(&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// http proxy &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-tag&quot;&gt;middleware&lt;/span&gt;: &lt;span class=&quot;selector-attr&quot;&gt;[jsonProxy]&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;插件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/chimurai/http-proxy-middleware&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/chimurai/http-proxy-middleware&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;8-默认任务&quot;&gt;&lt;a href=&quot;#8-默认任务&quot; class=&quot;headerlink&quot; title=&quot;8. 默认任务&quot;&gt;&lt;/a&gt;8. 默认任务&lt;/h3&gt;&lt;p&gt;&lt;code&gt;gulp&lt;/code&gt; 命令默认执行 &lt;code&gt;gulp.task(&amp;#39;default&amp;#39;, fn)&lt;/code&gt; 定义的任务。 如何将我们以上的任务组合在一起，使用&lt;code&gt;gulp.start([task1, task2])&lt;/code&gt;, 由于&lt;code&gt;gulp.start&lt;/code&gt;是并发式执行任务，这里推荐更好的队列方式插件来组合执行任务，按照声明的先后执行 task。&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;gulp&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.task&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;default&#39;&lt;/span&gt;, function(cb)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    $&lt;span class=&quot;selector-class&quot;&gt;.sequence&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;template:clean&#39;&lt;/span&gt;, [&lt;span class=&quot;string&quot;&gt;&#39;template&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;less&#39;&lt;/span&gt;], &lt;span class=&quot;string&quot;&gt;&#39;server&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;watch&#39;&lt;/span&gt;)(cb)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;插件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/teambition/gulp-sequence&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/teambition/gulp-sequence&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;构建发布生产及配置文件&quot;&gt;&lt;a href=&quot;#构建发布生产及配置文件&quot; class=&quot;headerlink&quot; title=&quot;构建发布生产及配置文件&quot;&gt;&lt;/a&gt;构建发布生产及配置文件&lt;/h2&gt;&lt;p&gt;构建发布生产环境主要做静态文件压缩，增加版权信息，拷贝。这里不详细阐述，具体查看 github。&lt;/p&gt;
&lt;p&gt;配置文件 &lt;code&gt;config.json&lt;/code&gt;，自定义分离出弹性可配置项，只有开发者自行修改 json 的字段，比如开发环境端口，生产环境预览端口等。生成发布的目录，在前公司直接生成到 svn 的目录上，再同步到公司项目。&lt;/p&gt;
&lt;p&gt;Git项目地址：&lt;br&gt;&lt;a href=&quot;https://github.com/tomieric/gulp-browsersync-boilerplate&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/tomieric/gulp-browsersync-boilerplate&lt;/a&gt;， 欢迎 star！&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/2016/09/01/startkit-1/&quot;&gt;配置5小时开发2分钟系列（1）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/2016/09/03/startkit-2/&quot;&gt;配置5小时开发2分钟系列（2）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/2016/09/05/startkit-3/&quot;&gt;配置5小时开发2分钟系列（3）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/2016/09/08/startkit-4/&quot;&gt;配置5小时开发2分钟系列（4）&lt;/a&gt;·&lt;/li&gt;
&lt;/ul&gt;
" data-url="http://tomieric.github.io/2016/09/03/startkit-2/">
        <div class="ds-share-inline">
          <ul  class="ds-share-icons-16">
            
            <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
            <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
            <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
            <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
            <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
            
          </ul>
          <div class="ds-share-icons-more">
          </div>
        </div>
     </div>
    </div> 
</div>


        
            <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2012 - 2017 TommyShao. All Rights Reserved. Powered by <a target="_blank" href="https://hexo.io">Hexo</a>. Theme by <a target="_blank" href="http://louisbarranqueiro.github.io/tranquilpeak-hexo-theme/">tranquilpeak</a>
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="3">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/09/05/startkit-3/"  data-tooltip="配置5小时开发2分钟系列（3）—— webpack 搭配 react">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/09/01/startkit-1/" data-tooltip="配置5小时开发2分钟系列（1）—— 即时刷新的browser-sync">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>


    <div class="post-actions post-action-share" style="float: left;padding-top:15px">
    <div class="ds-share" data-thread-key="2016/09/03/startkit-2/" data-title="配置5小时开发2分钟系列（2）—— gulp搭配browser-sync" data-images="" data-content="&lt;blockquote&gt;
&lt;p&gt;最近火遍朋友圈的 &lt;a href=&quot;https://www.v2ex.com/t/310767&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;在 2016 年学 JavaScript 是一种什么样的体验？&lt;/a&gt;，如果有一天选择做了前端，请把我埋在，深深的配置里…&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在前两年觉得前端是最容易入门上手的，而近两年感觉门槛高了，各种眼花缭乱的构建工具，各种配置。 &lt;/p&gt;
&lt;p&gt;本篇带来的是 &lt;code&gt;gulp搭配browser-sync&lt;/code&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;gulp搭配browser-sync&quot;&gt;&lt;a href=&quot;#gulp搭配browser-sync&quot; class=&quot;headerlink&quot; title=&quot;gulp搭配browser-sync&quot;&gt;&lt;/a&gt;gulp搭配browser-sync&lt;/h2&gt;&lt;p&gt;在&lt;a href=&quot;/2016/09/01/startkit-1/&quot;&gt;上一篇&lt;/a&gt; 介绍了 &lt;code&gt;browser-sync&lt;/code&gt;，本篇将介绍 &lt;code&gt;browser-sync&lt;/code&gt; 搭载 &lt;code&gt;gulp&lt;/code&gt; 实现构建环境。&lt;/p&gt;
&lt;p&gt;grunt 在很久以前用过，配置方式不太喜欢，所以一直使用 gulp，gulp的入门介绍就不详细介绍，可以看两年前的介绍,&lt;a href=&quot;http://tomieric.com/2014/08/20/gulp/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Gulp.js构建工具入门&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;gulp-配置开发&quot;&gt;&lt;a href=&quot;#gulp-配置开发&quot; class=&quot;headerlink&quot; title=&quot;gulp 配置开发&quot;&gt;&lt;/a&gt;gulp 配置开发&lt;/h3&gt;&lt;p&gt;在根目录下新建&lt;code&gt;gulpfile.js&lt;/code&gt; 文件，此文件为 &lt;code&gt;gulp&lt;/code&gt; 的入口文件，在终端直接输入 &lt;code&gt;gulp&lt;/code&gt;命令即可以执行配置。&lt;/p&gt;
&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;touch&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;gulpfile&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.js&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;使用 gulp 为我们管理 &lt;code&gt;less编译&lt;/code&gt;, &lt;code&gt;图片压缩&lt;/code&gt;, &lt;code&gt;js压缩&lt;/code&gt;, &lt;code&gt;模板编译&lt;/code&gt;, &lt;code&gt;http 服务&lt;/code&gt; 等，此时 gulpfile.js 文件将越来越臃肿。我们将 gulpfile.js 逐渐按业务逻辑拆分不同的文件。&lt;/p&gt;
&lt;p&gt;模板项目整体结构如下&lt;/p&gt;
&lt;figure class=&quot;highlight crystal&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;├── README.MD&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;├── config.json      配置文件&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;├── gulp             gulp 任务配置&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   ├── &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;lib&lt;/span&gt;          工具函数&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   └── task         gulp task 配置&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│        ├── defaultTask         默认任务，包括 ejs，less，编译及 server&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│        ├── spriteTask          sprite 合并任务，单独运行&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│        └── buildTask         构建&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;├── gulpfile.js&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;├── static&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   ├── css&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   ├── fonts&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   ├── images&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   ├── js&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   └── less&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;├── template           ejs模板&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   ├── _common&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   ├── upgrade.html&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;│   └── 首页.html&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;从结构中可以看到，将于 gulp相关的文件都放在 &lt;code&gt;gulp&lt;/code&gt; 文件夹下，而且按业务逻辑分成 &lt;code&gt;defaultTask&lt;/code&gt;默认的开发环境，&lt;code&gt;buildTask&lt;/code&gt; 构建发布的生产环境。&lt;/p&gt;
&lt;p&gt;此外static主要存放静态文件，template 存放 js 模板（使用 ejs 模板引擎管理静态页面，推荐更好的模板&lt;a href=&quot;https://mozilla.github.io/nunjucks/cn/api.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Nunjucks&lt;/a&gt;）&lt;/p&gt;
&lt;h3 id=&quot;1-入口文件&quot;&gt;&lt;a href=&quot;#1-入口文件&quot; class=&quot;headerlink&quot; title=&quot;1. 入口文件&quot;&gt;&lt;/a&gt;1. 入口文件&lt;/h3&gt;&lt;p&gt;入口文件为 gulp 构建工具默认的 &lt;code&gt;gulpfile.js&lt;/code&gt;文件，只需将拆分的 task 任务导入&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*-------------&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;*  默认任务&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-------------*/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;string&quot;&gt;&#39;./gulp/task/defaultTask&#39;&lt;/span&gt;)&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// code&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;...&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;因此我们需要在&lt;code&gt;./gulp/task/&lt;/code&gt;目录下新建&lt;code&gt;defaultTask.js&lt;/code&gt;文件，里面声明各自 task 执行的任务。&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// defaultTask.js &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; gulp   = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;gulp&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 配置文件&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; config = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;../../config.json&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 项目信息&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; pkg    = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;../../package.json&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// node 内置模块&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; path   = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;path&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; fs     = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;fs&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// gulp 加载插件&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; $      = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;gulp-load-plugins&#39;&lt;/span&gt;)()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.exports = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;defaultTask&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//...&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里使用的是&lt;code&gt;gulp-load-plugins&lt;/code&gt;, 减少声明太多变量&lt;/p&gt;
&lt;p&gt;插件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/jackfranklin/gulp-load-plugins&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/jackfranklin/gulp-load-plugins&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2-模板编译&quot;&gt;&lt;a href=&quot;#2-模板编译&quot; class=&quot;headerlink&quot; title=&quot;2. 模板编译&quot;&gt;&lt;/a&gt;2. 模板编译&lt;/h3&gt;&lt;p&gt;模板使用的是 &lt;code&gt;ejs&lt;/code&gt;(&lt;a href=&quot;http://ejs.co/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://ejs.co/&lt;/a&gt;)，比较简单上手（前公司用的是nujucks,感觉更好用), &lt;code&gt;ejs&lt;/code&gt; 支持变量的定义，js 语法，及&lt;code&gt;include&lt;/code&gt;标签，方便我们对静态页面进行公共部分拆分,仿佛回到3，4年前写smarty，tp 模板的赶脚~&lt;/p&gt;
&lt;figure class=&quot;highlight erb&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;%-&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;_common/header.html&#39;&lt;/span&gt;, config) &lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;container&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;ul&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;%&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; users.forEach(function(user)&amp;#123; &lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;%=&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; user.name &lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;%&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; &amp;#125; &lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;ul&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;%-&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;_common/list.html&#39;&lt;/span&gt;, [&amp;#123;&lt;span class=&quot;symbol&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;tommyshao&#39;&lt;/span&gt;&amp;#125;, &amp;#123;&lt;span class=&quot;symbol&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;ray&#39;&lt;/span&gt;&amp;#125;]) &lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;%-&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;_common/footer.html&#39;&lt;/span&gt;) &lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在 gulp 使用只需要 &lt;code&gt;$.ejs({ config: config})&lt;/code&gt;,其中 config 传入的是配置文件中的变量。模板中的公共模板(定义&lt;code&gt;_&lt;/code&gt;开头的文件或者文件夹)不需要编译因此需要过滤。完整的代码：&lt;/p&gt;
&lt;figure class=&quot;highlight aspectj&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 模板编译&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;gulp.task(&lt;span class=&quot;string&quot;&gt;&#39;template&#39;&lt;/span&gt;, function() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; gulp.src([config.template+&lt;span class=&quot;string&quot;&gt;&#39;/**/**.html&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;!&#39;&lt;/span&gt;+config.template+&lt;span class=&quot;string&quot;&gt;&#39;/**/_**.html&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;!&#39;&lt;/span&gt;+config.template+&lt;span class=&quot;string&quot;&gt;&#39;/_**/**.html&#39;&lt;/span&gt;])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                .pipe($.ejs(&amp;#123; config: config&amp;#125;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                .pipe($.prettify(&amp;#123; indent_size: 2&amp;#125;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                .pipe($.plumber(&amp;#123; errorHandler: $.notify.onError(&#39;错误: &amp;lt;%= &lt;span class=&quot;keyword&quot;&gt;error&lt;/span&gt;.message%&amp;gt;&#39;)&amp;#125;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                .pipe(gulp.dest(config.destPath))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                .pipe(reload(&amp;#123; stream: &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt; &amp;#125;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;config.template&lt;/code&gt; 配置文件中模板的目录&lt;/li&gt;
&lt;li&gt;&lt;code&gt;config.destPath&lt;/code&gt; 配置文件中模板编译后的目录，也是 http server 的根目录&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$.prettify({ indent_size: 2})&lt;/code&gt; 输出 html 以2个空格格式化&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;插件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/rogeriopvl/gulp-ejs&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/rogeriopvl/gulp-ejs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/jonschlinkert/gulp-prettify&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/jonschlinkert/gulp-prettify&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/floatdrop/gulp-plumber&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/floatdrop/gulp-plumber&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;3-less-样式编译&quot;&gt;&lt;a href=&quot;#3-less-样式编译&quot; class=&quot;headerlink&quot; title=&quot;3. less 样式编译&quot;&gt;&lt;/a&gt;3. less 样式编译&lt;/h3&gt;&lt;p&gt;less(&lt;a href=&quot;http://lesscss.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://lesscss.org/&lt;/a&gt;)是 css 的预编译器，可以定义变量，mixin，函数等，功能比较齐全和轻便。&lt;/p&gt;
&lt;p&gt;为了减少写更多的 mixin，这里推荐一个比较好用的插件&lt;code&gt;autoprefixer&lt;/code&gt;,它是属于现在比较火的预编译器&lt;code&gt;postcss&lt;/code&gt;内置组件。&lt;/p&gt;
&lt;p&gt;less 最终编译成 css，在调试的时候如何快速定位到 less 源文件的语句呢，需要使用到 &lt;code&gt;sourcemaps&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// less 编译&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;gulp.task(&lt;span class=&quot;string&quot;&gt;&#39;less&#39;&lt;/span&gt;, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; gulp.src([config.staticPath+&lt;span class=&quot;string&quot;&gt;&#39;/less/**/**.less&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;!&#39;&lt;/span&gt;+ config.staticPath+&lt;span class=&quot;string&quot;&gt;&#39;/less/**/_**.less&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;!&#39;&lt;/span&gt;+ config.staticPath+&lt;span class=&quot;string&quot;&gt;&#39;/less/_**/**.less&#39;&lt;/span&gt;])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .pipe($.sourcemaps.init())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .pipe($.plumber(&amp;#123; errorHandler: $.notify.onError(&lt;span class=&quot;string&quot;&gt;&#39;错误: &amp;lt;%= error.message %&amp;gt;&#39;&lt;/span&gt;)&amp;#125;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .pipe($.less())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .pipe($.autoprefixer(&lt;span class=&quot;string&quot;&gt;&#39;last 2 version&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;not ie &amp;lt;= 8&#39;&lt;/span&gt;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .pipe($.sourcemaps.write(&lt;span class=&quot;string&quot;&gt;&#39;./maps&#39;&lt;/span&gt;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .pipe(gulp.dest(config.staticPath+&lt;span class=&quot;string&quot;&gt;&#39;/css&#39;&lt;/span&gt;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .pipe(reload(&amp;#123; stream: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt; &amp;#125;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;$.sourcemaps.init()&lt;/code&gt;, &lt;code&gt;$.sourcemaps.write(&amp;#39;./maps&amp;#39;)&lt;/code&gt; sourcemaps声明&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$.less()&lt;/code&gt; less 文件编译&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$.autoprefixer(&amp;#39;last 2 version&amp;#39;, &amp;#39;not ie &amp;lt;= 8&amp;#39;)&lt;/code&gt; 浏览器css 语法自动增加前缀（-webkit，-moz），最新两款浏览器，IE8以上&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;插件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/floridoo/gulp-sourcemaps&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/floridoo/gulp-sourcemaps&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/plus3network/gulp-less&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/plus3network/gulp-less&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/sindresorhus/gulp-autoprefixer&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/sindresorhus/gulp-autoprefixer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;4-即时刷新-watch&quot;&gt;&lt;a href=&quot;#4-即时刷新-watch&quot; class=&quot;headerlink&quot; title=&quot;4. 即时刷新 watch&quot;&gt;&lt;/a&gt;4. 即时刷新 watch&lt;/h3&gt;&lt;p&gt;即时刷新主要是监听静态资源和 html 页面文件的内容变更，浏览器第一时间刷新页面。 使用 &lt;code&gt;gulp.watch&lt;/code&gt;搭配&lt;code&gt;browser-sync&lt;/code&gt; 的 &lt;code&gt;reload&lt;/code&gt; 函数&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 监听及时刷新&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;gulp&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.task&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;watch&#39;&lt;/span&gt;, function() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    gulp&lt;span class=&quot;selector-class&quot;&gt;.watch&lt;/span&gt;(config.template + &lt;span class=&quot;string&quot;&gt;&#39;/**/**.html&#39;&lt;/span&gt;, [&lt;span class=&quot;string&quot;&gt;&#39;template&#39;&lt;/span&gt;])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-tag&quot;&gt;gulp&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.watch&lt;/span&gt;(config.staticPath + &lt;span class=&quot;string&quot;&gt;&#39;/less/**/**&#39;&lt;/span&gt;, [&lt;span class=&quot;string&quot;&gt;&#39;less&#39;&lt;/span&gt;])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-tag&quot;&gt;gulp&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.watch&lt;/span&gt;(config.staticPath + &lt;span class=&quot;string&quot;&gt;&#39;/js/**/**&#39;&lt;/span&gt;)&lt;span class=&quot;selector-class&quot;&gt;.on&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;change&#39;&lt;/span&gt;, reload)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-tag&quot;&gt;gulp&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.watch&lt;/span&gt;(config.staticPath + &lt;span class=&quot;string&quot;&gt;&#39;/images/**/**&#39;&lt;/span&gt;)&lt;span class=&quot;selector-class&quot;&gt;.on&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;change&#39;&lt;/span&gt;, reload)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;reload&lt;/code&gt;在文件头部的声明使用&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// http server&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; browserSync = require(&lt;span class=&quot;string&quot;&gt;&#39;browser-sync&#39;&lt;/span&gt;).create()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; reload      = browserSync&lt;span class=&quot;selector-class&quot;&gt;.reload&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    .pipe(reload(&amp;#123; stream: true &amp;#125;))&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;插件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://browsersync.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://browsersync.io/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;5-sprite-雪碧图合并&quot;&gt;&lt;a href=&quot;#5-sprite-雪碧图合并&quot; class=&quot;headerlink&quot; title=&quot;5. sprite 雪碧图合并&quot;&gt;&lt;/a&gt;5. sprite 雪碧图合并&lt;/h3&gt;&lt;p&gt;sprite雪碧图合并可以将多张图片生成一张图片并生成 css 样式文件&lt;/p&gt;
&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;var spritesmith = require(&lt;span class=&quot;string&quot;&gt;&#39;gulp.spritesmith&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;spritesmith(&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    imgPath: &lt;span class=&quot;string&quot;&gt;&#39;../images/sprite/icon-home.png?v=&#39;&lt;/span&gt;+ &lt;span class=&quot;built_in&quot;&gt;config&lt;/span&gt;.version,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    imgName: folder+&lt;span class=&quot;string&quot;&gt;&#39;.png&#39;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    cssName: &lt;span class=&quot;string&quot;&gt;&#39;_&#39;&lt;/span&gt;+ folder+&lt;span class=&quot;string&quot;&gt;&#39;.css&#39;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    padding: &lt;span class=&quot;built_in&quot;&gt;config&lt;/span&gt;.sprite_padding&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;因此可以设计出多张 sprite 并发处理。详看：&lt;a href=&quot;https://github.com/tomieric/gulp-browsersync-boilerplate/blob/master/gulp/task/spriteTask.js&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/tomieric/gulp-browsersync-boilerplate/blob/master/gulp/task/spriteTask.js&lt;/a&gt; &lt;/p&gt;
&lt;h3 id=&quot;6-browser-sync-配置&quot;&gt;&lt;a href=&quot;#6-browser-sync-配置&quot; class=&quot;headerlink&quot; title=&quot;6. browser-sync 配置&quot;&gt;&lt;/a&gt;6. browser-sync 配置&lt;/h3&gt;&lt;p&gt;在上一篇就介绍了&lt;code&gt;browser-sync&lt;/code&gt; 作为 http server 服务的优点。这里我们就使用 &lt;code&gt;browser-sync&lt;/code&gt;的 api 搭载 gulp 来使用。&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// http server&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; browserSync = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;browser-sync&#39;&lt;/span&gt;).create()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 启动服务&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;gulp.task(&lt;span class=&quot;string&quot;&gt;&#39;server&#39;&lt;/span&gt;, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    browserSync.init(&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// 界面管理工具&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        ui: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            port: &lt;span class=&quot;number&quot;&gt;8080&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            weinre: &amp;#123; &lt;span class=&quot;comment&quot;&gt;// weinre工具移动设备代理端口&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                port: &lt;span class=&quot;number&quot;&gt;9090&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        server: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// 目录都作为根目录访问&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            baseDir: [&lt;span class=&quot;string&quot;&gt;&#39;./&#39;&lt;/span&gt;+ config.destPath, &lt;span class=&quot;string&quot;&gt;&#39;./static&#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            directory: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            routes: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&#39;/bower_components&#39;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&#39;./bower_components&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        host: Lib.getIPAddress(),&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        port: config.port,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// 使用浏览器打开&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// 可以自定义配置&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//   browser: [&#39;chrome&#39;, &#39;firefox&#39;, &#39;Internet Explore&#39;]&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// 只启动 chrome 开发&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        browser: [&lt;span class=&quot;string&quot;&gt;&#39;google chrome&#39;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;chrome&#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// 管理代理&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// middleware: [jsonProxy]&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;具体的&lt;code&gt;browser-sync&lt;/code&gt; 配置和介绍请看系列一的介绍。传送门： &lt;a href=&quot;/2016/09/01/startkit-1/&quot;&gt;即时刷新的browser-sync&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;7-接口代理&quot;&gt;&lt;a href=&quot;#7-接口代理&quot; class=&quot;headerlink&quot; title=&quot;7. 接口代理&quot;&gt;&lt;/a&gt;7. 接口代理&lt;/h3&gt;&lt;p&gt;在前端开发中比如需要ajax请求数据，做 js 模板的渲染等，我们如何请求另一台服务器的数据呢？很明显存在着跨域问题，很多同学说还不简单使用 jsonp 啊。&lt;/p&gt;
&lt;p&gt;但是不是还有比 jsonp 更简单的呢，就是将另一台服务器的接口代理到本地服务器，这样就作为同域处理了，比如我们代理了测试服务器上的数据，前后端的开发彼此不受影响，前端发布到测试服务器后可以上线对接。&lt;/p&gt;
&lt;p&gt;这里使用http 代理中间件&lt;code&gt;http-proxy-middleware&lt;/code&gt;, 支持 &lt;code&gt;connect&lt;/code&gt;,&lt;code&gt;express&lt;/code&gt;,&lt;code&gt;browser-sync&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;导入&lt;code&gt;http-proxy-middleware&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// http proxy&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; httpProxy = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;http-proxy-middleware&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 代理本地 http 请求以`/api/`开头的&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 统一返回 代理到测试服务器上接口数据&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 比如本地请求 /api/getUserInfo 返回的是测试服务器上的/getUserInfo接口数据&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; jsonProxy = httpProxy(&lt;span class=&quot;string&quot;&gt;&#39;/api/&#39;&lt;/span&gt;, &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    target: &lt;span class=&quot;string&quot;&gt;&#39;http://xxx.xxx.xxx.xxx:2016&#39;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    changeOrigin: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    pathRewrite: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&#39;/api&#39;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    logLevel: &lt;span class=&quot;string&quot;&gt;&#39;debug&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在&lt;code&gt;browser-sync&lt;/code&gt;中启用代理&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;browserSync&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.init&lt;/span&gt;(&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// http proxy &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-tag&quot;&gt;middleware&lt;/span&gt;: &lt;span class=&quot;selector-attr&quot;&gt;[jsonProxy]&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;插件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/chimurai/http-proxy-middleware&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/chimurai/http-proxy-middleware&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;8-默认任务&quot;&gt;&lt;a href=&quot;#8-默认任务&quot; class=&quot;headerlink&quot; title=&quot;8. 默认任务&quot;&gt;&lt;/a&gt;8. 默认任务&lt;/h3&gt;&lt;p&gt;&lt;code&gt;gulp&lt;/code&gt; 命令默认执行 &lt;code&gt;gulp.task(&amp;#39;default&amp;#39;, fn)&lt;/code&gt; 定义的任务。 如何将我们以上的任务组合在一起，使用&lt;code&gt;gulp.start([task1, task2])&lt;/code&gt;, 由于&lt;code&gt;gulp.start&lt;/code&gt;是并发式执行任务，这里推荐更好的队列方式插件来组合执行任务，按照声明的先后执行 task。&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;gulp&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.task&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;default&#39;&lt;/span&gt;, function(cb)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    $&lt;span class=&quot;selector-class&quot;&gt;.sequence&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;template:clean&#39;&lt;/span&gt;, [&lt;span class=&quot;string&quot;&gt;&#39;template&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;less&#39;&lt;/span&gt;], &lt;span class=&quot;string&quot;&gt;&#39;server&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;watch&#39;&lt;/span&gt;)(cb)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;插件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/teambition/gulp-sequence&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/teambition/gulp-sequence&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;构建发布生产及配置文件&quot;&gt;&lt;a href=&quot;#构建发布生产及配置文件&quot; class=&quot;headerlink&quot; title=&quot;构建发布生产及配置文件&quot;&gt;&lt;/a&gt;构建发布生产及配置文件&lt;/h2&gt;&lt;p&gt;构建发布生产环境主要做静态文件压缩，增加版权信息，拷贝。这里不详细阐述，具体查看 github。&lt;/p&gt;
&lt;p&gt;配置文件 &lt;code&gt;config.json&lt;/code&gt;，自定义分离出弹性可配置项，只有开发者自行修改 json 的字段，比如开发环境端口，生产环境预览端口等。生成发布的目录，在前公司直接生成到 svn 的目录上，再同步到公司项目。&lt;/p&gt;
&lt;p&gt;Git项目地址：&lt;br&gt;&lt;a href=&quot;https://github.com/tomieric/gulp-browsersync-boilerplate&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/tomieric/gulp-browsersync-boilerplate&lt;/a&gt;， 欢迎 star！&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/2016/09/01/startkit-1/&quot;&gt;配置5小时开发2分钟系列（1）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/2016/09/03/startkit-2/&quot;&gt;配置5小时开发2分钟系列（2）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/2016/09/05/startkit-3/&quot;&gt;配置5小时开发2分钟系列（3）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/2016/09/08/startkit-4/&quot;&gt;配置5小时开发2分钟系列（4）&lt;/a&gt;·&lt;/li&gt;
&lt;/ul&gt;
" data-url="http://tomieric.github.io/2016/09/03/startkit-2/">
        <div class="ds-share-inline">
          <ul  class="ds-share-icons-16">
            
            <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
            <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
            <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
            <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
            <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
            
          </ul>
          <div class="ds-share-icons-more">
          </div>
        </div>
     </div>
    </div> 
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="3">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://tomieric.github.io/2016/09/03/startkit-2/">
                <i class="fa fa-google-plus"></i><span class="">分享到 Google+</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://tomieric.github.io/2016/09/03/startkit-2/">
                <i class="fa fa-facebook-official"></i><span>分享到 Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://tomieric.github.io/2016/09/03/startkit-2/">
                <i class="fa fa-twitter"></i><span>分享到 Twitter</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="http://service.weibo.com/share/share.php?appkey=583395093&amp;title=&amp;url=http://tomieric.github.io/2016/09/03/startkit-2/&amp;source=bshare&amp;retcode=0&amp;ralateUid=1799786352">
                <i class="fa fa-weibo"></i><span>分享到 微博</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        <!-- Define author's picture -->


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar.jpg"/>
        
            <h4 id="about-card-name">TommyShao</h4>
        
            <h5 id="about-card-bio"><p>只想做一位安静的切图仔</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>前端开发工程师</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                中国 广州
            </h5>
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script.min.js"></script>
<script>
  var disqus_config = function () {
      this.page.url = 'http://tomieric.github.io/2016/09/03/startkit-2/';
      
        this.page.identifier = '2016/09/03/startkit-2/';
      
  };
(function() {
    var d = document, s = d.createElement('script');
    var disqus_shortname = 'tomieric';
    s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script>
<!--SCRIPTS END-->

</html>
